<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="it-loading.html" />

<polymer-element name="it-list" attributes="databaseId method">
  <template>
    <it-loading loading?="{{!items.length}}">
      <template repeat="{{ item in items }}">
        <a href="{{ item['@file'].uri }}"><div title="{{ item.uuid }}">{{ item['@file'].uri }}</div></a>
      </template>
    </it-loading>
  </template>

  <script>
    Polymer('it-list',{
      databaseId : '',
      method : 'fetchAll',
      items: [],
      error: null,
      ready: function(){
        var self = this;
        var db = document.querySelector('#'+this.databaseId);

        switch(this.method){
          case 'fetchAll' :
            db.fetchAll(function(err, items){
              if(err){
                self.error = err;
              }else{
                self.items = items;
              }
            });
          break;
          case 'removedItems' :
            db.doDiff(function(err, diffReport){
              if(err){
                self.error = err;
              }else{
                self.items = diffReport['removedItems'];
              }
            });
          break;
          case 'addedItems' :
            db.doDiff(function(err, diffReport){
              if(err){
                self.error = err;
              }else{
                self.items = diffReport['addedItems'];
              }
            });
          break;
        }
        
      }
    });
  </script>
</polymer-element>
