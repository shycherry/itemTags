<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer-ajax/polymer-ajax.html">

<polymer-element name="itdb-element" attributes="databaseUrl">
  <template>
    <polymer-ajax id="postAjax" method="POST" contentType="application/json" handleAs="json">
    </polymer-ajax>
    
    <polymer-ajax id="getAjax" method="GET" handleAs="json">
    </polymer-ajax>
  </template>
  
  <script>
    function myGetAjaxHelper(iUrl, iCallback){
      var myGetAjax = this.$.getAjax.cloneNode();
        myGetAjax.url = this.databaseUrl+iUrl;

        myGetAjax.addEventListener('polymer-response', function(e){
          if(iCallback) iCallback(null, e.detail.response);
        });
        myGetAjax.addEventListener('polymer-error', function(e){
          if(iCallback) iCallback(e.detail.response, null);
        });

        myGetAjax.go();
    }

    Polymer('itdb-element',{
      databaseUrl: '/',
      configure: function(){
        
      },
      dumpDb: function(){

      },
      save: function(){

      },
      fetchItemsSharingTags: function(){

      },
      fetchAllTags: function(iCallback){
        myGetAjaxHelper.call(this, 'fetch_all_tags', iCallback);
      },
      fetchAllByFilter: function(){

      },
      fetchOneByFilter: function(){

      },
      fetchOne: function(){

      },
      fetchAll: function(iCallback){
        myGetAjaxHelper.call(this, 'fetch_all', iCallback);
      },      
      deleteOne: function(){

      },      
      deleteAll: function(){

      },
      cloneDb: function(){

      },
      diffDb: function(){

      },
      //todo to move
      doWatch: function(iCallback){
        myGetAjaxHelper.call(this, 'do_watch', iCallback);
      },
      doDiff: function(iCallback){
        myGetAjaxHelper.call(this, 'do_diff', iCallback);
      },
      doSwitch: function(iCallback){
        myGetAjaxHelper.call(this, 'do_switch', iCallback);
      },
      handleError: function(iEvent, iData){
        this.error = iData;
      },
      handleResponse: function(iEvent, iData){
        console.log(iData.response);
      }
      
    });
  </script>
</polymer-element>
