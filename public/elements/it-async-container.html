<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer-ajax/polymer-ajax.html">

<polymer-element name="it-async-container" attributes="getUrl">
  <template>
    <polymer-ajax id="ajax" url="{{ getUrl }}" auto 
      method="GET"
      handleAs="json"
      on-polymer-error='{{ handleError }}'
      on-polymer-response='{{ handleResponse }}'>
    </polymer-ajax>

    <template if="{{ status == 'error' }}">
      Error: {{error}}
    </template>

    <template if="{{ status == 'pending' }}">
      Fetching...
    </template>
    
    <template if="{{ status == 'responded' }}">
      <content></content>
    </template>

  </template>
  <script>
    Polymer('it-async-container',{
      getUrl: '',
      status:'unknown',
      error: null,
      getUrlChanged: function(){
        this.status = 'pending';
      },
      handleError: function(iEvent, iData){
        console.log('ooops ! that\'s an error !');
        this.status = 'error';
        error = iData;
        this.fire('error', iData);
      },
      handleResponse: function(iEvent, iData){
        this.status = 'responded';
        this.fire('response', iData.response);
      }
    });
  </script>
</polymer-element>
